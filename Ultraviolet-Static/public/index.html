<!DOCTYPE html>
<html>
<head>
    <title>Tab System </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="uv/uv.bundle.js" defer></script>
    <script src="uv/uv.config.js" defer></script>
    <script src="register-sw.js" defer></script>
    <script src="search.js" defer></script>
    <script src="index.js" defer></script>
    <script src="options.js" defer></script>
</head>
<body onload="addTab(`<i class='fa-solid fa-house'></i> Home`, 'home.html');">
    <div class="tab-container">
      <ul class="tabs">
        </ul>
        <div class="input-container">
          <i class="fas fa-plus" id="add-tab-btn"></i></li>
            <i class="fas fa-times" id="closetabbtn"></i>
                <button class="back-btn"><i class="fas fa-chevron-left"></i></button>
                <button class="refresh-btn"><i class="fas fa-sync"></i></button>
                <button class="forward-btn"><i class="fas fa-chevron-right"></i></button>    
              <form class="inputcontainermain" id="uv-form">
                <input class="search" type="text" id="uv-address" placeholder="Type URL here">
                <input style="z-index: -9999;" id="uv-search-engine" value="" type="hidden"/>
              </form>
              <div class="dropdown">
                <button class="dropdown-button">
                    <i class="fa-solid fa-caret-down fa-lg"></i> Accessibility & Tools
                </button>
              <div class="dropdown-content">
                <a href="#"><i class="fa-solid fa-user-ninja"></i> About:Blank</a>
                <a onclick="settingoptions()"><i class="fa-solid fa-gear"></i> Settings</a>
                <a href="#"><i class="fa-solid fa-wrench"></i> Toggle Dev Tools</a>
                <a href="#"><i class="fa-solid fa-circle-info"></i> Help/Info</a>
                <a href="#"><i class="fa-solid fa-shuffle"></i> Bare Switcher</a>
              </div>
            </div>
        </div>
        <div class="tab-panels">
            <div class="tab-panel active" data-src="https://ludicrous.icu/">
                <iframe src="https://ludicrous.icu/" frameborder="0"></iframe>
            </div>
        </div>
    </div>
    <div class="desc left-margin">
      <p id="uv-error"></p>
      <pre id="uv-error-code"></pre>
    </div>
    <script src="tab.js"></script>
    <script src="settings/js/index.js"></script>
    <script src="settings/js/panic.js"></script>
</body>
</html>

<script>
  var searchEngineValue = localStorage.getItem("searchengine");
    if (!searchEngineValue) {
    searchEngineValue = "https://www.google.com/search?q=%s";
  }
  document.getElementById("uv-search-engine").value = searchEngineValue;
  </script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("uv-form");
    const address = document.getElementById("uv-address");
    const searchEngine = document.getElementById("uv-search-engine");
    const error = document.getElementById("uv-error");
    const errorCode = document.getElementById("uv-error-code");

    const registerServiceWorker = registerSW().catch((err) => {
      error.textContent = "Failed to register service worker.";
      errorCode.textContent = err.toString();
      throw err;
    });

    window.addEventListener('load', async () => {
      await registerServiceWorker();
    });

    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      await registerServiceWorker();
      const url = search(address.value, searchEngine.value);
      const imgsrc = `https://t3.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${url}&size=15`;
      const faviconsrc = `<img src="${imgsrc}">`;
      changeTabSrc(__uv$config.prefix + __uv$config.encodeUrl(url));
      setTimeout(function() {
        const activeTabPanel = document.querySelector('.tab-panel.active');
        const iframe = activeTabPanel.querySelector('iframe');
        iframe.addEventListener('load', updatefaviconagain);
      }, 3000);
    });

    window.addEventListener("storage", (event) => {
      if (event.key === "mainurl") {
        registerServiceWorker.then(() => {
          const url = search(address.value, searchEngine.value);
          const imgsrc = `https://t3.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${url}&size=15`;
          const faviconsrc = `<img src="${imgsrc}">`;
          changeTabSrc(__uv$config.prefix + __uv$config.encodeUrl(url));
          setTimeout(function() {
            const activeTabPanel = document.querySelector('.tab-panel.active');
            const iframe = activeTabPanel.querySelector('iframe');
            iframe.addEventListener('load', updatefaviconagain);
          }, 3000);
        });
      }
    });
  });
</script>